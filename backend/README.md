# DB create tables

## Users

```sql
CREATE TYPE role_t AS ENUM('user', 'editor', 'admin');

CREATE TABLE users (
    id             integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username       varchar(255),
    email          varchar(255) NOT NULL,
    password       varchar(255),
    fullName       varchar(255),
    role           role_t NOT NULL DEFAULT 'user',
    blocked        boolean NOT NULL DEFAULT FALSE,
    avatar         text
);
```

## Posts

```sql
CREATE TABLE posts (
    id             integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title          varchar(255) NOT NULL,
    summary        varchar(255) NOT NULL,
    body           text DEFAULT '',
    date_created   timestamp NOT NULL DEFAULT NOW(),
    date_updated   timestamp NOT NULL DEFAULT NOW(),
    author_id      integer,
    published      boolean NOT NULL DEFAULT FALSE,
    image          text DEFAULT '',
    color          varchar(50) DEFAULT '#26c6da',
    CONSTRAINT fk_user
      FOREIGN KEY(author_id) REFERENCES users(id)
);
```

## Tags

```sql
CREATE TABLE tags (
    id            integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name          varchar(255) NOT NULL
);
```

## Tag_Post

```sql
CREATE TABLE tag_post (
    tag_id         integer,
    post_id        integer,
    CONSTRAINT tag_post_pk PRIMARY KEY (tag_id, post_id),
    CONSTRAINT fk_tag
      FOREIGN KEY (tag_id) REFERENCES tags (id),
    CONSTRAINT fk_post
      FOREIGN KEY (post_id) REFERENCES posts (id)
);
```

## Favourites

```sql
CREATE TABLE favourites (
    post_id        integer,
    user_id        integer,
    CONSTRAINT favourite_pk PRIMARY KEY (post_id, user_id),
    CONSTRAINT fk_post
      FOREIGN KEY (post_id) REFERENCES posts (id),
    CONSTRAINT fk_user
      FOREIGN KEY (user_id) REFERENCES users (id)
);
```

## Likes

```sql
CREATE TABLE likes (
    post_id        integer,
    user_id        integer,
    CONSTRAINT like_pk PRIMARY KEY (post_id, user_id),
    CONSTRAINT fk_post
      FOREIGN KEY (post_id) REFERENCES posts (id),
    CONSTRAINT fk_user
      FOREIGN KEY (user_id) REFERENCES users (id)
);
```

## Comments

```sql
CREATE TABLE comments (
    post_id        integer,
    user_id        integer,
    body           text,
    date_created   timestamp NOT NULL DEFAULT NOW(),
    date_updated   timestamp NOT NULL DEFAULT NOW(),

    CONSTRAINT comment_pk PRIMARY KEY (post_id, user_id),
    CONSTRAINT fk_post
      FOREIGN KEY (post_id) REFERENCES posts (id),
    CONSTRAINT fk_user
      FOREIGN KEY (user_id) REFERENCES users (id)
);
```

# DB scheme

![db scheme 0.1](https://drive.google.com/uc?export=view&id=1LWgiKfFSwrTIfYnsfAQjOa7sDSQc4oLN "db scheme 0.1")

# Systemd config

```bash
[Unit]
Description=blog api

[Service]
User=kuder
Group=www-data
EnvironmentFile=/home/kuder/.blog_env
ExecStart=/home/kuder/myblog/backend/backend.o
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
```
